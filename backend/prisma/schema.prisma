generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

///////////////////////
// BOARDGAME (OWNED)
///////////////////////

model Boardgame {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // BGG identity
  bggId Int    @unique
  name  String

  thumbnail       String?
  description     String?
  yearPublished   Int?
  minPlayers      Int?
  maxPlayers      Int?
  bestPlayerCount Int[]
  minPlaytime     Int?
  maxPlaytime     Int?
  weight          Float?
  bggRank         Int?
  bggLink         String?

  category BoardgameCategories @default(STANDALONE)

  // Ownership
  purchases Purchase[]

  designers   Designer[]
  mechanics   Mechanics[]
  publisher   Publisher   @relation(fields: [publisherId], references: [id])
  publisherId Int

  // Knowledge about expansions (owned OR NOT)
  expansionReferences       ExpansionReference[]
  ownedAsExpansionReference ExpansionReference?  @relation("OwnedExpansion")

  @@index([bggId])
  @@index([category])
  @@map("boardgames")
}

///////////////////////
// EXPANSION REFERENCE
///////////////////////

model ExpansionReference {
  id Int @id @default(autoincrement())

  bggId Int
  name  String

  baseGame Boardgame @relation(fields: [baseGameId], references: [id])
  baseGameId Int

  // Optional link if this expansion is owned
  ownedExpansion   Boardgame? @relation("OwnedExpansion", fields: [ownedExpansionId], references: [id])
  ownedExpansionId Int?       @unique

  @@unique([baseGameId, bggId])
  @@index([bggId])
  @@map("expansion_references")
}

///////////////////////
// PURCHASE
///////////////////////

model Purchase {
  id    Int      @id @default(autoincrement())
  price Float
  date  DateTime @default(now())

  boardgame   Boardgame @relation(fields: [boardgameId], references: [id])
  boardgameId Int

  @@index([boardgameId])
  @@map("purchases")
}

///////////////////////
// DESIGNER
///////////////////////

model Designer {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name String @unique

  boardgames Boardgame[]

  @@map("designers")
}

///////////////////////
// PUBLISHER
///////////////////////

model Publisher {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name String @unique

  boardgames Boardgame[]

  @@map("publishers")
}

///////////////////////
// MECHANICS
///////////////////////

model Mechanics {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  name      String   @unique

  boardgames Boardgame[]

  @@map("mechanics")
}

///////////////////////
// ENUMS
///////////////////////

enum BoardgameCategories {
  STANDALONE
  EXPANSION
  ADDON
  EXTRA
  ACCESSORY
}
